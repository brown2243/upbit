# UPBIT 매매 봇

## 사전 준비

### 1. 일별 거래 데이터 기준

업비트는 UTC(협정세계시)를 기준으로 일별 데이터를 계산합니다. 대다수의 글로벌 거래소들이 UTC 기준 시간을 사용하고 있어 해외 시세 비교에 용이한 장점이 있습니다. UTC는 한국시간(KST)보다 9시간이 느립니다.

### 2. 수수료

|           | 거래 수수료    |
| --------- | -------------- |
| KRW 마켓  | 0.139% → 0.05% |
| BTC 마켓  | 0.25%          |
| USDT 마켓 | 0.25%          |

거래수수료에는 부가세가 포함되어 있습니다.
거래수수료 계산방식: 체결금액(주문수량 x 주문가격) x 거래수수료율(%)

- KRW 마켓 거래수수료는 소수점 둘째 자리까지 표시됩니다.
  거래수수료 정산방식:
  매수 주문 시 정산금액 = 체결금액(주문수량 x 주문가격) + 거래수수료

  - 예시) 1BTC를 10,000,000원에 매수(거래수수료 0.139%) 시 내 계정에 1BTC 반영, 10,013,900원 차감
    매도 주문 시 정산금액 = 체결금액(주문수량 x 주문가격) – 거래수수료
  - 예시) 1BTC를 10,000,000원에 매도(거래수수료 0.139%) 시 내 계정에 9,986,100원 반영, 1 BTC 차감

  거래수수료는 이벤트에 따라 달라질 수 있습니다.
  <br />

- Maker/Taker 란? // 수수료가 같기에 구분X
  - Maker: 오더북 내의 즉시 체결되지 않는 조건의 매수/매도 잔량을 추가해주는 주문을 말합니다.
  - Taker: 오더북 내의 매수/매도 잔량을 즉시 체결 시키는 주문을 말합니다.

## 매매 전략에 대한 생각.

아무래도 코인은 수급이 전부이니까, [돌파매매, 추세추종전략] 쪽으로 생각했었음.
시총이 작은 애들을 선별해서, 작전세력이 작전을 치든, 어떠한 이슈로 개인의 매수세가 몰리는 종목에 탑승하는 방식.

막상 작업을 들어가니까, 너무 생각을 해야할 게 많아서 골치 아프던 차 아래의 사이트를 발견.

https://wikidocs.net/21888

전략의 구현이 간단하고, 이미 시장에서 입증 된 전략으로 보임.
이렇게 공개 된 전략은 엣지를 잃는다고 하지만,

1. 애매하게 시스템 트레이딩을 하고싶은 사람이라면(나처럼) 이 전략을 모방하거나, 비슷하게 갈 것

   - 그냥 파이썬이면 코드 복붙해도 작동할 듯
   - 매도가 굉장히 중요한데 이 전략은 매도를 당일로 하기에, 구현이 간단
   - 알고리즘 매매는 보통 초단타매매를 생각하는데, 거래비용+슬립피지 때문에 거래 횟수는 작은게 낫다.
   - 위의 이유로 이 전략을 추종하는 사람이 많다면, 실제로 시장은 따라가는 경향성이 생긴다.

2. 정말 준비 된 or 기업형 or 전문가들은 더 복잡한 로직이나 이것 저것 사용할 것이다.
   - 하지만 그들이 운용하는 자금이 개인보다 많다고 해도, 전체적인 시장에서는 개인의 자금 규모가 더 클것
   - 신생시장이고 공익투자자들이 많이 때문에, 공개 된 전략이라도 충분히 승산이 있다고 본다.

## 전략 설명

시총이 작은 종목들을 선별 후

이동평균 + 변동성 돌파 전략

- 이번 절에서는 앞서 구현했던 변동성 돌파 전략에 이동평균(Moving Average)을 이용한 상승장 투자 전략을 결합시켜 보겠습니다. 두 전략이 결합됐기 때문에 복잡해 보일 수 있지만 현재 가격이 5일 이동평균보다 높은지를 비교하는 코드만 추가해주면 됩니다. 먼저 종가를 기준으로 5일 이동평균을 계산해 봅시다.

- 래리 윌리엄스(Larry Williams)가 Long-Term Secrets to Short-Term Trading에서 소개한 변동성 돌파 전략은 최근 '가즈아! 가상화폐 투자 마법공식 (강환국 저)' 등에서 소개된 이후로 국내에서도 유명해졌습니다. 변동성 돌파 전략을 간략히 요약해 보면 아래와 같습니다.

1. 가격 변동폭 계산: 투자하려는 가상화폐의 전일 고가(high)에서 전일 저가(low)를 빼서 가상화폐의 가격 변동폭을 구합니다.
2. 매수 기준: 당일 시간에서 (변동폭 \* 0.5) 이상 상승하면 해당 가격에 바로 매수합니다.
3. 매도 기준: 당일 종가에 매도합니다.
   간단한 예제와 함께 변동성 돌파 전략을 이해해 봅시다. 가상화폐는 24시간 거래되고 있기 때문에 먼저 시가와 종가를 계산할 기준 시간을 잡아야 합니다. 00:00:00 분부터 그날의 거래가 시작되고 23:59:59에 거래가 종료된다고 가정합시다.
   1. 가격 변동폭은 00:00:00~23:59:59 사이의 거래 중에서 가장 높았던 금액과 가장 낮았던 금액을 빼주면 되겠지요? 예를 들어 12월 10일의 비트코인의 고가가 460만 원이고 저가가 300만 원이었다면 이날의 가격 변동폭은 160만 원입니다.
   2. 12월 11일 비트코인의 시가(open)가 400만 원이라면 12월 11일의 매수 목표가는 400 + 160 x 0.5 = 480만 원이 됩니다. 12월 11일 하루 종일 일정한 시간마다 현재가를 계속 조회하다가 현재가가 매수 목표가인 480만 원을 넘어서면 바로 매수합니다.
   3. 매도는 12월 12일 00:00:00초에 갖고 있는 비트코인을 시장가로 전량 매도합니다.

## 구현 과정

1. 시총이 작은 애들을 찾기

- upbit API 에는 코인 시총을 보내주지 않음(내가 못찾은 것 일수도)
- 그래서 업빗에 상장 된 코인 티커를 전부 가져옴
- 가져온 코인 티커 목록으로 coinmarketcap에서 시총 가져옴

  - 여기서 발생한 문제는, coinmarketcap이 전세계 코인을 대상으로 하다 보니 Ticker가 중복이 있었다는 것.
  - 시총이 낮은 코인인 줄 알고 무지성 매수를 했었는데, 실제 시총이 낮지 않았던, ticker가 같아 발생한 문제.

2. 이동평균 + 돌파매매 구현하기

   1. 이동평균 구하기
      1. 5일 간의 종가의 평균을 낸 값
   2. 돌파매매 전략 구현
      1. 현재가 >= 금일 시가 + (전일 (고가 - 저가) \* range(전략에선 0.5))
      2. 1.의 조건이 충족할 때 매수하기

3. 매수
4. 매도
   1. 매도
   2. 손절

API관련 참조 https://note.heyo.me

## 투자일지

### 4월 18일 - 1 일차

프로그램을 만들면서, 무지성 매수를 해봄.
새벽에 비트코인이 떡락하며 -7만원

(100만 -> 93만)

### 4월 19일 - 2 일차

위에 작성되어 있는 변동성 돌파매매 전략 구현
매수가 5번 되었는데, 2번은 상승, 3번은 하락 이었다.
**신기한 건, 상승 중 한번을 포함한 총 4번이 매수타이밍을 찍자마자 하락 했다는 것.**

시장이 안좋은 걸, 감안하더라도 전략을 수정해야 할것 같다.
(93만- 13만 => 80만)

### 4월 20일 - 3 일차

- DAWN - 오전 9시경 폭등할 때, 돌파 전략 매수 시점을 돌파해 매수하자 마자 하락.

전략 수정
시가 + 갭* 0.15 에서 매수해서 갭 * 0.49(원래 매수 시점)에 매도
먹을 자리를 줄인 전략이기 때문에, 종목을 매도 후, 가격이 매수가보다 더 떨어진다면, 다시 매수를 고려하게 짰다.

- AXS 5% 정도 수익 - 얘는 홀딩 했으면 좀 더 수익 났음
- STPT 5% 정도 수익- 이 전략이 유효
- TON - 매수되기 힘든 종목이었는데 갑자기 1초? 피뢰침에 매수됨
- EMC2 - -3% 손실 딱히 수익시점 X

수정된 전략도 현재가격이 (시가 + gap \* 0.15) 이상이 되어야 매수가 되는데,
전체적 하락장이라 매수도 안되는 중.

투자금 추가 100
(180만 => 185만)

### 4월 21일 - 4 일차

(185만 => 190만)

핫한 시간대(그냥 보면서 느낌)

- 오전 9시
  - 이때 급 떡상하는 종목들 탈 수 있게, 현금 준비
- 오전 11시?
- 오후 6시 10 ~ 20분
- 오후 10시

전략 수정

- 갭 = 전일 고가 - 저가
- 갭이 큰 종목은 4시간 평균 + 갭* 0.15 에서 매수해서 갭 * 0.49에 매도

  - 정말 신기하게 저 매도타이밍 지나면 하락하는 경우가 잦음
  - 누군가 안티 변동성 돌파 전략을 구현한게 아닐까...?

- 갭이 작은 종목은 매수 4시간 평균 종가 + 갭 * 0.49, 매도 4시간 평균 종가 *1.15

  - 갭이 작다는 것은 전일 변동성이 낮았다는 것을 의미(코인은 정말 변동성이 큼)
  - 그래서 매수를 더 고가에서 하지만, 그정도 상승 폭이 있다면, 한방 터질 수 도 있다.
  - 그러면 15%정도 먹고 빠지는...!

- 매도 한 종목은 30분은 매수할 수 없게 설정
  - 고가에서 매도했는데 주가가 하락할 때, 매수되는 현상 방지
- 1시간 봉 종가 4개로 평균을 내기에 1시간마다, 업데이트

매매 횟수가 정말 많은데 어째어째 원금 유지가 되는 걸 보면,
전략이 아주 이상한 건 아닌 것 같다.
이젠 일상을 위해, 최소 일주일은 전략을 고수할 계획이다.

### 4월 22일 - 5 일차

(190만 => 180만)

- 전체적으로 개떡락하면서 175만원까지 하락했다가 조금씩 상승
  - 손절 로직 구현
- 새벽 4시 50분정도에 전량 매도하고 8시부터 다시 매매 시작 해야할 듯
  - 상황보고 구현
- 최근에 암호화폐에 관한 뉴스나, 시장분위기로 볼때, 조금 더 보수적이어야 할 것 같다.

### 4월 19일 - 2 일차

### 4월 19일 - 2 일차
